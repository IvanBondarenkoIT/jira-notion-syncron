# Инструкция по установке и настройке транскрибации видео

## Что нужно для работы

### 1. Системные требования

- **Python 3.10+**
- **ffmpeg** (для извлечения аудио из видео)
- **Интернет** (для первой загрузки модели Vosk, ~50 МБ)

### 2. Установка ffmpeg

#### Windows:
1. Скачайте ffmpeg с https://www.gyan.dev/ffmpeg/builds/
2. Распакуйте в `C:\ffmpeg\bin\`
3. Добавьте `C:\ffmpeg\bin\ffmpeg-YYYY-MM-DD-git-XXXXX-full_build\ffmpeg-YYYY-MM-DD-git-XXXXX-full_build\bin` в PATH системы
   - Панель управления → Система → Дополнительные параметры → Переменные среды
   - Добавьте путь в переменную PATH
4. Перезапустите PowerShell/терминал

#### Linux/Mac:
```bash
# Ubuntu/Debian
sudo apt-get install ffmpeg

# Mac
brew install ffmpeg
```

### 3. Установка Python зависимостей

```bash
# Активируйте виртуальное окружение
# Windows:
venv\Scripts\activate

# Linux/Mac:
source venv/bin/activate

# Установите зависимости для транскрибации
pip install vosk==0.3.45 soundfile==0.12.1 ffmpeg-python==0.2.0 rapidfuzz==3.9.7 loguru==0.7.2
```

### 4. Структура папок

Убедитесь, что существуют следующие папки:
```
data/
├── input/
│   └── videos/          # Сюда поместите видео файлы (.mp4)
├── processed/
│   ├── transcripts/     # Сюда сохраняются транскрипты
│   └── analysis/        # Сюда сохраняются результаты анализа
└── models/              # Сюда автоматически скачается модель Vosk
```

### 5. Использование

#### Транскрибация видео:
```bash
python scripts/transcribe_videos.py
```

Скрипт:
- Найдет все `.mp4` файлы в `data/input/videos/`
- Извлечет аудио с помощью ffmpeg
- Распознает речь с помощью Vosk (модель скачается автоматически при первом запуске)
- Сохранит результаты в `data/processed/transcripts/` (`.txt` и `.json`)

#### Анализ планов и отчетов:
```bash
python scripts/analyze_plans_reports.py
```

Скрипт:
- Загрузит все транскрипты
- Сгруппирует по датам
- Классифицирует: понедельник = план, пятница = отчет
- Сопоставит планы с отчетами
- Создаст отчеты в `data/processed/analysis/`:
  - `summary.md` - Markdown отчет
  - `summary.csv` - CSV для Excel
  - `{дата}.json` - детальные данные по каждому дню

### 6. Формат имен файлов

Видео файлы должны иметь формат:
```
round_YYYY-MM-DD_HH-MM-SS.mp4
```

Например:
- `round_2025-10-27_18-11-17.mp4` - запись от 27 октября 2025, 18:11:17

### 7. Альтернатива: OpenAI Whisper API

Если хотите использовать OpenAI Whisper (лучшее качество, но требует API ключ):

1. Получите API ключ на https://platform.openai.com/api-keys
2. Создайте файл `.env` в корне проекта:
   ```
   OPENAI_API_KEY=your-api-key-here
   ```
3. Установите пакет:
   ```bash
   pip install openai==1.51.0
   ```
4. Скрипт автоматически использует OpenAI вместо Vosk

### 8. Устранение проблем

**Ошибка "ffmpeg not found":**
- Убедитесь, что ffmpeg установлен и добавлен в PATH
- Перезапустите терминал после изменения PATH

**Ошибка "No module named 'vosk'":**
- Установите зависимости: `pip install vosk==0.3.45 soundfile==0.12.1`

**Модель Vosk не скачивается:**
- Проверьте интернет-соединение
- Модель скачивается автоматически при первом запуске (~50 МБ)

**Плохое качество транскрибации:**
- Vosk small model - базовое качество, работает офлайн
- Для лучшего качества используйте OpenAI Whisper API

### 9. Что копировать на другой компьютер

**Обязательно:**
- Весь репозиторий (код)
- `requirements.txt`
- `config/env.template` (если используете .env)

**Не нужно копировать:**
- `venv/` - создайте новое виртуальное окружение
- `data/models/` - модель скачается автоматически
- `data/processed/` - результаты обработки
- `data/input/videos/` - исходные видео (если не нужны)
- `.env` - создайте заново с вашими ключами

**На новом компьютере:**
1. Клонируйте репозиторий
2. Создайте виртуальное окружение: `python -m venv venv`
3. Активируйте его
4. Установите ffmpeg
5. Установите зависимости: `pip install -r requirements.txt` или только для транскрибации (см. п.3)
6. Поместите видео в `data/input/videos/`
7. Запустите скрипты

